var pt=Object.defineProperty;var ft=(a,t,e)=>t in a?pt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var O=(a,t,e)=>(ft(a,typeof t!="symbol"?t+"":t,e),e),q=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var h=(a,t,e)=>(q(a,t,"read from private field"),e?e.call(a):t.get(a)),v=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)},X=(a,t,e,s)=>(q(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e);var C=(a,t,e)=>(q(a,t,"access private method"),e);var w;class Y{constructor(){v(this,w,{})}on(t,e){h(this,w)[t]?h(this,w)[t].push(e):h(this,w)[t]=[e]}off(t,e){if(h(this,w)[t])if(typeof e=="function"){const s=h(this,w)[t].indexOf(e);if(s===-1)return;h(this,w)[t].splice(s,1)}else h(this,w)[t]=[]}dispatch(t,e){h(this,w)[t]&&h(this,w)[t].forEach(function(s){s.call(this,e)})}}w=new WeakMap;var y,T,R;class gt extends Y{constructor(){super(...arguments);v(this,T);v(this,y,{})}call(e,s){for(let i in h(this,y))h(this,y)[i][e]&&C(this,T,R).call(this,e,h(this,y)[i],s)}get(e){return h(this,y)[e]}getModules(){return h(this,y)}register(e,s){let i;typeof s=="function"?i=new s:i=s,h(this,y)[e]=i,this[e]=i,C(this,T,R).call(this,"onRegister",i),this.dispatch("register")}remove(e){let s;if(typeof e=="string"&&(s=e,e=this.get(e)),!s){for(let i in h(this,y))if(h(this,y)[i]===e){s=i;break}}delete h(this,y)[s],delete this[s],C(this,T,R).call(this,"onDestroy",e),this.dispatch("remove")}}y=new WeakMap,T=new WeakSet,R=function(e,s,i){!e||!s||!s[e]||(e=s[e],e(i))};mw.require("editor.js");mw.require("css_parser.js");const vt=function(){var a=document.querySelector("#mw-live-edit-editor"),t=function(){var l={};this.on=function(c,m){l[c]?l[c].push(m):l[c]=[m]},this.dispatch=function(c,m){l[c]&&l[c].forEach(function(g){g.call(this,m)})},this.provide=function(c){this.dispatch("change",c.map(function(m){return{label:m,value:m}}))}},e=new t;window.fontFamilyProvider=e;const s=mw.app.get("canvas").getFrame();s.contentWindow.fontFamilyProvider=e;const i=mw.Editor({document:s.contentWindow.document,executionDocument:s.contentWindow.document,actionWindow:s.contentWindow,element:a,mode:"document",regions:".edit",skin:"le2",editMode:"liveedit",scopeColor:"white",controls:[[{group:{icon:"mdi mdi-format-title",controls:["format","lineHeight"]}},{group:{controller:"bold",controls:["italic","underline","strikeThrough","removeFormat"]}},"fontSelector","fontSize",{group:{controller:"alignLeft",controls:["alignLeft","alignCenter","alignRight","alignJustify"]}},{group:{controller:"ul",controls:["ol"]}},"image",{group:{controller:"link",controls:["unlink"]}},{group:{controller:"textColor",controls:["textBackgroundColor"]}}]],smallEditorPositionX:"center",smallEditorSkin:"lite",interactionControls:[],id:"live-edit-wysiwyg-editor",minHeight:250,maxHeight:"70vh",state:mw.liveEditState,fontFamilyProvider:e});var n=document.getElementById("toolbar-undo"),o=document.getElementById("toolbar-redo");i.state.on("record",function(){o.disabled=!i.state.hasPrev,n.disabled=!i.state.hasNext}),i.state.on("change",function(){o.disabled=!i.state.hasPrev,n.disabled=!i.state.hasNext}),n.addEventListener("click",function(){i.state.undo()}),o.addEventListener("click",function(){i.state.redo()}),a.innerHTML="",a.appendChild(i.wrapper);var r=i.storage.get(i.settings.id+"-small-editor-pinned");typeof r>"u"&&typeof i.smallEditorApi<"u"&&i.smallEditorApi.pin(),mw.app.register("richTextEditor",i),mw.app.register("richTextEditorAPI",i.api)};var f;class wt extends Y{constructor(){super();v(this,f,null)}go(e){h(this,f)&&h(this,f).ownerDocument&&h(this,f).contentWindow&&(h(this,f).src=e)}refresh(){h(this,f)&&h(this,f).ownerDocument&&h(this,f).contentWindow&&h(this,f).contentWindow.location.reload()}getFrame(){if(h(this,f)&&h(this,f).ownerDocument)return h(this,f)}getWindow(){if(h(this,f)&&h(this,f).ownerDocument)return h(this,f).contentWindow}getDocument(){if(h(this,f)&&h(this,f).ownerDocument)return h(this,f).contentWindow.document}mount(e){this.dispatch("liveEditBeforeLoaded"),mw.spinner({element:e,size:52,decorate:!0});const s=document.createElement("iframe");s.src=`${mw.settings.site_url}?editmode=n`,s.frameBorder=0,s.id="live-editor-frame",s.referrerPolicy="no-referrer",X(this,f,s),e.innerHTML="",e.appendChild(s),s.addEventListener("load",i=>{this.dispatch("liveEditCanvasLoaded"),mw.spinner({element:e}).remove()})}}f=new WeakMap;class L{static extend(){const t={};let e=!1,s=0;const i=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(e=arguments[0],s++);const n=function(o){for(const r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e&&Object.prototype.toString.call(o[r])==="[object Object]"?t[r]=L.extend(!0,t[r],o[r]):t[r]=o[r])};for(;s<i;s++){const o=arguments[s];n(o)}return t}}let B;const P=document.documentElement;P.matches?B="matches":P.matchesSelector?B="matchesSelector":P.mozMatchesSelector?B="mozMatchesSelector":P.webkitMatchesSelector&&(B="webkitMatchesSelector");class _{static fragment(){return this._fragment||(this._fragment=document.createElement("div"),this._fragment.style.visibility="hidden",this._fragment.style.position="absolute",this._fragment.style.width="1px",this._fragment.style.height="1px",document.body.appendChild(this._fragment)),this._fragment}static matches(t,e){return t[B](e)}static isBlockLevel(t){if(!t||t.nodeType===3)return!1;var e=t.nodeName;if(typeof this._isBlockCache[e]<"u")return this._isBlockCache[e];var s=document.createElement(e);return this.fragment().appendChild(s),this._isBlockCache[e]=getComputedStyle(s).display==="block",this.fragment().removeChild(s),this._isBlockCache[e]}static firstBlockLevel(t){for(;t&&t.classList;){if(this.isBlockLevel(t))return t;t=t.parentNode}}static firstWithBackgroundImage(t){if(!t)return null;for(;t&&t.nodeName!=="BODY";){if(t.style.backgroundImage)return t;t=t.parentElement}return null}static hasAnyOfClassesOnNodeOrParent(t,e){for(;t&&t.nodeName!=="BODY";){let s=0,i=e.length;for(;s<i;s++)if(t.classList.contains(e[s]))return!0;t=t.parentElement}return!1}static hasParentsWithClass(t,e){if(t){for(var s=t.parentNode;s&&s.nodeName!=="BODY";){if(s.classList.contains(e))return!0;s=s.parentNode}return!1}}static hasParentWithId(t,e){if(t){for(var s=t.parentNode;s&&s.nodeName!=="BODY";){if(s.id===e)return!0;s=s.parentNode}return!1}}static firstWithAyOfClassesOnNodeOrParent(t,e){for(;t&&t.nodeName!=="BODY";){let s=0,i=e.length;for(;s<i;s++)if(t.classList.contains(e[s]))return t;t=t.parentElement}return null}static firstParentOrCurrentWithTag(t,e){if(!(!t||!e)){e=typeof e!="string"?e:[e];for(var s=t;s&&s.nodeName!=="BODY";){if(e.indexOf(s.nodeName.toLowerCase())!==-1)return s;s=s.parentNode}return!1}}static index(t,e,s){s=s||t.tagName.toLowerCase(),e=e||t.parentNode;var i;e.constructor===[].constructor?i=e:i=e.querySelectorAll(s);for(var n=0,o=i.length;n<o;n++)if(t===i[n])return n}static firstParentOrCurrentWithClass(t,e){if(!t)return!1;for(var s=t;s&&s.nodeName!=="BODY";){if(s.classList.contains(e))return s;s=s.parentNode}return!1}static firstParentOrCurrent(t,e){if(!t)return!1;for(var s=t;s&&s.nodeName!=="BODY";){if(s.matches(e))return s;s=s.parentNode}return!1}static firstParentOrCurrentWithAnyOfClasses(t,e){if(!t)return!1;for(var s=t;s&&s.nodeName!=="BODY";){if(!s)return!1;if(this.hasAnyOfClasses(s,e))return s;s=s.parentNode}return!1}static parentsOrCurrentOrderMatchOrOnlyFirst(t,e){let s=t;for(;s&&s.nodeName!=="BODY";){const i=s.classList.contains(e[0]),n=s.classList.contains(e[1]);if(i&&n)return!1;if(i)return!0;if(n)return!1;s=s.parentNode}return!1}static parentsOrCurrentOrderMatchOrOnlyFirstOrNone(t,e){let s=t;for(;s&&s.nodeName!=="BODY";){const i=s.classList.contains(e[0]),n=s.classList.contains(e[1]);if(i&&n)return!1;if(i)return!0;if(n)return!1;s=s.parentNode}return!0}static hasAnyOfClasses(t,e){if(!t)return;let s=0,i=e.length;for(;s<i;s++)if(t.classList.contains(e[s]))return!0;return!1}static offset(t){if(t){var e=t.getBoundingClientRect(),s={top:e.top,left:e.left,width:e.width,height:e.height,bottom:e.bottom,right:e.right};return s.top+=t.ownerDocument.defaultView.scrollY,s.bottom+=t.ownerDocument.defaultView.scrollY,s.left+=t.ownerDocument.defaultView.scrollX,s.right+=t.ownerDocument.defaultView.scrollX,s}}static parentsOrder(t,e){for(var s=[],i={},n=e.length,o=0,r=-1;o<n;o++)i[e[o]]=-1;if(!t)return i;for(var l=t.parentNode;l&&l.nodeName!=="BODY";){for(r++,o=0;o<n;o++)l.classList.contains(e[o])&&s.indexOf(e[o])===-1&&(i[e[o]]=r,s.push(e[o]));l=l.parentNode}return i}}O(_,"_isBlockCache",{}),O(_,"_fragment");class yt{constructor(t){this.settings=t,this.tools=_}isRow(t){return t.classList.contains(this.settings.rowClass)}isModule(t){return t.classList.contains(this.settings.moduleClass)&&t.dataset.type!=="layouts"}isLayout(t){return t.classList.contains(this.settings.moduleClass)&&t.dataset.type==="layouts"}isInLayout(t){if(!t)return!1;for(t=t.parentNode;t&&t!==this.settings.document.body;){if(t.classList.contains(this.settings.moduleClass)&&t.dataset.type==="layouts")return!0;t=t.parentNode}}isElement(t){return t.classList.contains(this.settings.elementClass)}isEmptyElement(t){return t.classList.contains(this.settings.emptyElementClass)}isEdit(t){return t.classList.contains(this.settings.editClass)}isInEdit(t){var e=[this.settings.editClass,this.settings.moduleClass];return this.tools.parentsOrCurrentOrderMatchOrOnlyFirst(t.parentNode,e)}isEditOrInEdit(t){return this.isEdit(t)||this.isInEdit(t)}isPlainText(t){return t.classList.contains(this.settings.plainElementClass)}getType(t){if(this.isEdit(t))return"edit";if(this.isElement(t))return"element";if(this.isModule(t))return"module";if(this.isLayout(t))return"layout"}}class rt extends yt{constructor(t){super(t),this.settings=t,this._tagsCanAccept=["DIV","ARTICLE","ASIDE","FOOTER","HEADER","MAIN","SECTION","DD","LI","TD","FORM"],this.init()}isConfigurable(t){return this.isElement(t)||this.isModule(t)||this.isRow(t)}isEditableLayout(t){return this.this.isLayout(t)&&this.isInEdit(t)}canMoveModule(t){return this.isModule(t)&&this.isInEdit(t)}canAcceptByClass(t){return this.tools.hasAnyOfClasses(t,this.dropableElements())}canAcceptByTag(t){return!t||t.nodeType!==1?!1:this._tagsCanAccept.indexOf(t.nodeName)!==-1}allowDrop(t){return this.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(t,[this.settings.allowDrop,this.settings.nodrop])}canInsertBeforeOrAfter(t){return this.canAccept(t.parentNode)}canAccept(t){return!!(this.canAcceptByClass(t)&&this.isEditOrInEdit(t)&&this.allowDrop(t))}canReceiveElements(t){return this.isEdit(t)&&this.canAcceptByTag(t)}dropableElements(){return this._dropableElements}getIteractionTarget(t){return this.tools.firstWithAyOfClassesOnNodeOrParent(t,[this.settings.elementClass,this.settings.editClass,this.settings.moduleClass])}getTarget(t,e){const s=this.getIteractionTarget(t);if(!s||!this.isEditOrInEdit(t)||!this.allowDrop(t))return null;const i={target:s,canInsert:!1,beforeAfter:!1};var n=this.settings.strictLayouts&&this.isLayout(e),o=this.settings.strict&&!this.isLayout(e)&&!this.isInLayout(s);if(o)return null;if(this.isEdit(s))i.canInsert=!n;else if(this.isElement(s)&&!n)this.canAcceptByTag(s)&&(i.canInsert=!n),i.beforeAfter=!0;else if(this.isModule(s)&&!n)if(this.canInsertBeforeOrAfter(s))i.beforeAfter=!0;else return null;else if(this.isLayout(s))if(this.canInsertBeforeOrAfter(s))i.beforeAfter=!0;else return null;return i}init(){this._dropableElements=[this.settings.elementClass,this.settings.cloneableClass,this.settings.editClass,this.settings.moduleClass,this.settings.colClass,this.settings.allowDrop]}}let Ct=-1;const bt=(a,t)=>{if(!a||!t)return!1;const e=t.target;if(!e||e.nodeType!==1)return!1;a.pageX;const s=a.pageY,i=_.offset(e),n={},o=15;if(Ct===s||!t||!t.canInsert&&!t.beforeAfter)return!1;if(t.canInsert&&t.beforeAfter)if(s>=i.top-o&&s<=i.top+o)n.position="top",n.action="before";else if(s>=i.top+o&&s<=i.top+i.height/2)n.position="top",n.action="prepend";else if(s>=i.top+i.height/2&&s<=i.bottom-o)n.position="bottom",n.action="append";else if(s>=i.top+i.height/2&&s>=i.bottom-o)n.position="bottom",n.action="after";else return!1;else if(t.beforeAfter)if(s>=i.top-o&&s<=i.top+i.height/2)n.position="top",n.action="before";else if(s>=i.top+i.height/2&&s<=i.bottom+o)n.position="bottom",n.action="after";else return!1;else if(t.canInsert)if(s>=i.top-o&&s<=i.top+i.height/2)n.position="top",n.action="prepend";else if(s>=i.top+i.height/2&&s<=i.bottom+o)n.position="bottom",n.action="append";else return!1;return n};var H=function(a,t){var e=this;this.isMWElement=!0,this.toggle=function(){this.css("display",this.css("display")==="none"?"block":"none")},this._active=function(){return this.nodes[this.nodes.length-1]},this.getDocument=function(){return this._active().ownerDocument},this.getWindow=function(){return this.getDocument().defaultView},this.get=function(i,n){this.nodes=(n||document).querySelectorAll(i)},this.each=function(i){if(this.nodes)for(var n=0;n<this.nodes.length;n++)i.call(this.nodes[n],n);else this.node&&i.call(this.node,0);return this},this.encapsulate=function(){};var s=function(i,n){i&&(Array.isArray(i)?i.forEach(function(o){s(o,n)}):i instanceof H?n.append(i):typeof i=="object"&&n.append(new H(i)))};this.create=function(){var i=this.document.createElement(this.settings.tag);if(this.node=i,this.settings.encapsulate===!0){var n=this.settings.encapsulate===!0?"open":this.settings.encapsulate;i.attachShadow({mode:n})}this.nodes=[i],this.settings.content&&s(this.settings.content,this)},this._specialProps=function(i,n){if(i==="tooltip")return this.node.dataset[i]=n,!0},this.setProps=function(){for(var i in this.settings.props)if(i==="dataset")for(var n in this.settings.props[i])this.node.dataset[n]=this.settings.props[i][n];else if(i==="style")for(var o in this.settings.props[i])this.node.style[o]=this.settings.props[i][o];else{var r=this.settings.props[i];this._specialProps(i,r)||(this.node[i]=r)}},this.__={cssNumber:["animationIterationCount","columnCount","fillOpacity","flexGrow","flexShrink","fontWeight","gridArea","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","lineHeight","opacity","order","orphans","widows","zIndex","zoom"]},this._normalizeCSSValue=function(i,n){return typeof n=="number"&&this.__.cssNumber.indexOf(i)===-1&&(n=n+"px"),n},this.css=function(i,n){if(typeof i=="string")if(typeof n<"u"){var o=this._normalizeCSSValue(i,n);this.each(function(){this.style[i]=o})}else return this.document.defaultView.getComputedStyle(this.node)[i];if(typeof i=="object")for(var r in i)this.each(function(){this.style[r]=e._normalizeCSSValue(r,i[r])});return this},this.dataset=function(i,n){return typeof n>"u"?this._active()[i]:(this.each(function(){this.dataset[i]=n}),this)},this.attr=function(i,n){return typeof n>"u"?this._active()[i]:(this.each(function(){this.setAttribute(i,n)}),this)},this.val=function(i){return typeof i>"u"?this._active().value:(this.each(function(){this.value=i}),this)},this.prop=function(i,n){var o=this._active();return typeof n>"u"?o[i]:(o[i]!==n&&(o[i]=n,this.trigger("propChange",[i,n])),this)},this.hide=function(){return this.each(function(){this.style.display="none"})},this.show=function(){return this.each(function(){this.style.display=""})},this.find=function(i){var n=mw.element("#r"+new Date().getTime());return this.each(function(){for(var o=this.querySelectorAll(i),r=0;r<o.length;r++)n.nodes.indexOf(o[r])===-1&&n.nodes.push(o[r])}),n},this.addClass=function(i){return i=i.trim().split(" "),this.each(function(){var n=this;i.forEach(function(o){n.classList.add(o)})})},this.toggleClass=function(i){return this.each(function(){this.classList.toggle(i.trim())})},this.removeClass=function(i){var n=Array.isArray(i);if(n)return this.each(function(){for(var r=0,l=i.length;r<l;r++)this.classList.remove(i[r])});i=i.trim();var o=i.split(" ");return o.length>1?this.removeClass(o):this.each(function(){this.classList.remove(i)})},this.remove=function(){return this.each(function(){this.remove()})},this.empty=function(){return this.html("")},this.html=function(i){return typeof i>"u"?this._active().innerHTML:this.each(function(){this.innerHTML=i})},this.text=function(i,n){if(typeof i>"u")return this.node.textContent;typeof n>"u"&&(n=!0),n&&(i=this.document.createRange().createContextualFragment(i).textContent),this.node.innerHTML=i},this._asdom=function(i){return typeof i=="string"?this.document.createRange().createContextualFragment(i):i.node?i.node:i.nodes?i.nodes[i.nodes.length-1]:i},this.offset=function(){var i=this._active(),n=this.getWindow(),o=i.getBoundingClientRect();return o.offsetTop=o.top+n.pageYOffset,o.offsetBottom=o.bottom+n.pageYOffset,o.offsetLeft=o.left+n.pageXOffset,o},this.width=function(i){return i?this.css("width",i):this._active().offsetWidth},this.height=function(i){return i?this.css("height",i):this._active().offsetHeight},this.parent=function(){return mw.element(this._active().parentNode)},this.parents=function(i){i=i||"*";var n=this._active(),o=n.parentElement,r=mw.element();for(r.nodes=[];o;)o.matches(i)&&r.nodes.push(o),o=o.parentElement;return r},this.append=function(i){return i&&this.each(function(){this.append(e._asdom(i))}),this},this.before=function(i){return i&&this.each(function(){this.parentNode&&this.parentNode.insertBefore(e._asdom(i),this)}),this},this.after=function(i){i&&this.each(function(){this.parentNode&&this.parentNode.insertBefore(e._asdom(i),this.nextSibling)})},this.prepend=function(i){return i&&this.each(function(){this.prepend(e._asdom(i))}),this},this._disabled=!1,Object.defineProperty(this,"disabled",{get:function(){return this._disabled},set:function(i){this._disabled=i,this.node.disabled=this._disabled,this.node.dataset.disabled=this._disabled}}),this.trigger=function(i,n){return n=n||{},this.each(function(){this.dispatchEvent(new CustomEvent(i,{detail:n,cancelable:!0,bubbles:!0})),e._on[i]&&e._on[i].forEach(function(o){o.call(this,i,n)})}),this},this.get=function(i){return this.nodes[i]},this.wrap=function(i){var n=et(i);this.before(n),n.append(this)},this._on={},this.on=function(i,n){return i=i.trim().split(" "),i.forEach(function(o){e._on[o]||(e._on[o]=[]),e._on[o].push(n),e.each(function(){this.addEventListener(o,n,!1)})}),this},this.init=function(){if(this.nodes=[],this.root=t||document,this.root instanceof H&&(this.root=this.root.get(0)),this._asElement=!1,this.document=this.root.body?this.root:this.root.ownerDocument,a=a||{},a.nodeName&&a.nodeType)this.nodes.push(a),this.node=a,a={},this._asElement=!0;else if(typeof a=="string")if(a.indexOf("<")===-1)this.nodes=Array.prototype.slice.call(this.root.querySelectorAll(a)),a={},this._asElement=!0;else if(this.settings&&this.settings.content instanceof H)this.append(this.settings.content);else if(this.settings&&typeof this.settings.content=="object")this.append(new H(this.settings.content));else{var i=this._asdom(a);this.nodes=[].slice.call(i.children),this._asElement=!0}a=a||{};var n={tag:"div",props:{}};this.settings=L.extend({},n,a),!this._asElement&&(this.create(),this.setProps())},this.init()};const et=function(a,t){return new H(a,t)};et.module=function(a,t){H.prototype[a]=t};const U="mw-le-element";window.customElements&&!customElements.get(U)&&customElements.define(U,class extends HTMLElement{constructor(){super()}});const u=(a,t)=>(a instanceof Object&&!a.nodeType&&(a=L.extend({},a||{},{tag:a.tag||U})),et(a,t)),Lt=function(a,t){var e={handle:null,element:null,document,helper:!0},s=this,i={};this.on=function(o,r){i[o]?i[o].push(r):i[o]=[r]},this.dispatch=function(o,r){i[o]&&i[o].forEach(function(l){l.call(this,r)})};var n=function(o){s.settings.document.body.style.scrollBehavior="smooth",s.settings.document.defaultView.scrollTo(0,s.settings.document.defaultView.scrollY+o),s.settings.document.body.style.scrollBehavior=""};this.config=function(){this.settings=L.extend({},e,a),this.settings.target||(this.settings.target=this.settings.document.body),this.setElement(this.settings.element),this.dropIndicator=this.settings.dropIndicator},this.setElement=function(o){this.element=u(o).get(0),this.settings.handle||(this.settings.handle=this.settings.element),this.handle=this.settings.handle,this.handle.attr("draggable","true")},this.setTargets=function(o){this.targets=u(o)},this.addTarget=function(o){this.targets.push(o)},this.init=function(){this.config(),this.draggable()},this.helper=function(o){return this._helper||(this._helper=u().get(0),this._helper.className="mw-draggable-helper",this.settings.document.body.appendChild(this._helper)),o==="create"?(this._helper.style.top=o.pageY+"px",this._helper.style.left=o.pageX+"px",this._helper.style.width=s.element.offsetWidth+"px",this._helper.style.height=s.element.offsetHeight+"px",this.settings.document.documentElement.classList.add("le-dragging"),this._helper.style.display="block"):o==="remove"&&this._helper?(this._helper.style.display="none",this.settings.document.documentElement.classList.remove("le-dragging")):this.settings.helper&&o&&(this._helper.style.top=o.pageY+"px",this._helper.style.left=o.pageX+"px",this._helper.style.maxWidth=s.settings.document.defaultView.innerWidth-o.pageX-40+"px",this.settings.document.documentElement.classList.add("le-dragging")),this._helper},this.isDragging=!1,this.dropableService=new rt(t),this.dropPosition=bt,this.draggable=function(){u(this.settings.target).on("dragleave",function(o){s.dropIndicator.hide()}),u(this.settings.target).on("dragover",function(o){if(s.target=null,s.action=null,o.target!==s.element||!s.element.contains(o.target)){var r=s.dropableService.getTarget(o.target,s.element);if(r&&r!==s.element){const l=s.dropPosition(o,r);l?(s.target=r.target,s.action=l.action,s.dropIndicator.position(s.target,l.action+"-"+l.position)):s.dropIndicator.hide()}else s.dropIndicator.hide();s.isDragging&&(s.dispatch("dragOver",{element:s.element,event:o}),o.preventDefault())}}).on("drop",function(o){s.isDragging&&(o.preventDefault(),s.target&&s.action&&u(s.target)[s.action](s.element),s.dropIndicator.hide(),s.dispatch("drop",{element:s.element,event:o})),s.dropIndicator.hide()}),this.handle.on("dragstart",function(o){s.isDragging=!0,s.element.id||(s.element.id="mw-element-"+new Date().getTime()),s.element.classList.add("mw-element-is-dragged"),o.dataTransfer.setData("text",s.element.id),o.dataTransfer.effectAllowed="move",s.helper("create"),s.dispatch("dragStart",{element:s.element,event:o})}).on("drag",function(o){var r=90,l=5;o.clientY<r&&n(-l),o.clientY>innerHeight-(r+(this._helper?this._helper.offsetHeight+10:0))&&n(l),o.dataTransfer.dropEffect="copy",s.dispatch("drag",{element:s.element,event:o}),s.helper(o)}).on("dragend",function(o){s.isDragging=!1,s.element.classList.remove("mw-element-is-dragged"),s.helper("remove"),s.dispatch("dragEnd",{element:s.element,event:o})})},this.init()},j=function(a){var t={},e=this;this.settings=L.extend({},t,a);const s={};this.on=(r,l)=>{s[r]?s[r].push(l):s[r]=[l]},this.dispatch=(r,l)=>{s[r]&&s[r].forEach(c=>{c.call(this,l)})};var i=!0,n=null;this.getTarget=function(){return n},this.isVisible=function(){return i},this.show=function(){i=!0,this.wrapper.removeClass("mw-handle-item-hidden")},this.hide=function(){i=!1,this.wrapper.addClass("mw-handle-item-hidden")};let o=null;this.setContent=function(r){o&&o.remove(),o=r,this.wrapper.append(o)},this.initDraggable=function(){this.draggable=new Lt({handle:this.handle,element:null,helper:!0,dropIndicator:this.settings.dropIndicator,document:this.settings.document,target:this.settings.root,stateManager:this.settings.stateManager,type:this.settings.type},a),this.draggable.on("dragStart",function(){e.wrapper.addClass("mw-handle-item-dragging")}),this.draggable.on("dragEnd",function(){e.wrapper.removeClass("mw-handle-item-dragging")})},this.set=function(r){if(!r){n=null;return}var l=_.offset(r);this.wrapper.css({top:l.top,left:l.left,width:l.width,height:l.height}),this.show(),this.draggable.setElement(r),n!==r&&(n=r,this.dispatch("targetChange",r))},this.createHandle=function(){this.settings.handle?this.handle=this.settings.handle:(this.handle=u({tag:"div",props:{className:"mw-handle-item-handle",contentEditable:!1,draggable:!0}}),this.wrapper.append(this.handle))},this.createWrapper=function(){this.wrapper=u({tag:"div",props:{className:"mw-handle-item "+(this.settings.className||"mw-handle-type-default"),id:this.settings.id||"mw-handle-"+new Date().getTime(),contentEditable:!1}}),this.wrapper.on("mousedown",function(){this.classList.remove("mw-handle-item-mouse-down")}),u(document.body).on("mouseup touchend",function(){e.wrapper.removeClass("mw-handle-item-mouse-down")}),this.settings.document.body.appendChild(this.wrapper.get(0))},this.createWrapper(),this.createHandle(),this.initDraggable(),this.settings.content&&this.setContent(this.settings.content),this.hide()},Et=function(a){a=a||{},this.tools=_;var t=this,e={exceptions:["mw-handle-item"]};this.settings=L.extend({},e,a),this.settings.root.nodeType===9?this.document=this.settings.root:this.document=this.settings.root.ownerDocument,this.body=this.document.body;var s=20,i=function(r){return r%5>=2.5?r/5*5+5:r/5*5},n=function(r,l){r=i(r),l=i(l);for(var c=[],m=r-s,g=r+s,d=l-s,p=l+s;m<g;m+=5)for(;d<=p;d+=5)c.push([m,d]);return c},o=function(r,l){r&&r.parentElement&&l.indexOf(r)===-1&&t.body!==r&&l.push(r)};this.fromEvent=function(r){return t.tools.hasAnyOfClassesOnNodeOrParent(r.target,this.settings.exceptions)?[]:(t.document._test||(t.document._test=document.createElement("div"),t.document._test.style.position="absolute",t.document._test.style.left="10px",t.document._test.style.background="red",t.document._test.style.width="10px",t.document._test.style.height="10px",t.document.body.appendChild(t.document._test)),t.document._test.style.top=r.pageY+"px",this.fromPoint(r.pageX,r.pageY))},this.fromPoint=function(r,l){var c=[];t.document.defaultView.frameElement&&(l-=t.document.defaultView.scrollY);var m=t.document.elementFromPoint(r,l);if(!m)return[];o(m,c);var g=n(r,l);return g.forEach(function(d){o(t.document.elementFromPoint(d[0],d[1]),c)}),c}},_t=function(a){return _.matches(a,'.row,[class*="row-"]')},Nt=function(a){return _.matches(a,'.col,[class*="col-"]')};let N;const it=function(){return N||(N=document.createElement("div"),N.style.visibility="hidden",N.style.position="absolute",N.style.width="1px",N.style.height="1px",document.body.appendChild(N)),N},V={},Mt=function(a){if(!a||a.nodeType===3)return!1;var t=a.nodeName;if(typeof V[t]<"u")return V[t];var e=document.createElement(t);return it().appendChild(e),V[t]=getComputedStyle(e).display==="block",it().removeChild(e),V[t]},kt=(a,t,e)=>{a=a||"*";for(var s=t.querySelectorAll(a),i=0,n=[];i<s.length;i++)!Nt(s[i])&&!_t(s[i])&&!e.elementAnalyzer.isEdit(s[i])&&Mt(s[i])&&n.push(s[i]);return n},Ht=a=>{const{backgroundImageHolder:t,editClass:e,moduleClass:s,elementClass:i,allowDrop:n}=a.settings,o=a.root;for(var r=o.querySelectorAll("."+e+"."+t+", ."+e+" ."+t+", ."+e+'[style*="background-image"], .'+e+' [style*="background-image"]'),l=o.querySelectorAll("."+s+a.settings.unEditableModules.join(",."+s)),c=o.querySelectorAll("."+e),m=0,g=0,d=0;m<r.length;m++){var p=r[m];a.elementAnalyzer.isInEdit(p)&&(mw.tools.hasClass(p,s)||mw.tools.addClass(p,e),p.style.backgroundImage||(p.style.backgroundImage="none"))}for(;g<l.length;g++)l[m].classList.remove(s);for(;d<c.length;d++){for(var E=kt(":not(."+i+")",c[d],a),A=0,st=c[d].querySelectorAll("."+n),$=0;$<st.length;$++)st[$].classList.add(i);for(;A<E.length;A++)E[A].classList.contains(s)||a.elementAnalyzer.isInEdit(E[A])&&E[A].classList.add(i)}},xt=function(a){this.handles=a,this.dragging=!1;var t=this;this.get=function(e){return this.handles[e]},this.set=function(e,s){this.get(e).set(s)},this.hide=function(e){e&&this.handles[e]?this.handles[e].hide():this.each(function(s,i){i.hide()})},this.hideAllBut=function(e){this.each(function(s,i){s!==e&&i.hide()})},this.show=function(e){e&&this.handles[e]?this.handles[e].show():this.each(function(s,i){i.show()})},this.each=function(e){if(e){var s;for(s in this.handles)e.call(t,s,this.handles[s])}},this.init=function(){this.each(function(e,s){s.draggable.on("dragStart",function(){t.dragging=!0,t.hideAllBut(e)}),s.draggable.on("dragEnd",function(){t.dragging=!1,s.show()})})},this.init()},Tt=function(a){a=a||{};const t={template:"default"};let e={};this.settings=L.extend({},t,a),this._indicator=null;const s={};this.on=function(l,c){s[l]?s[l].push(c):s[l]=[c]},this.dispatch=function(l,c){s[l]&&s[l].forEach(function(m){m.call(this,c)})},this.visible=!1,this.hide=function(){this.visible&&(this._indicator.addClass("mw-drop-indicator-hidden"),this.visible=!1,e={})},this.show=function(){console.log(this.visible),this.visible||this._indicator.removeClass("mw-drop-indicator-hidden"),this.visible=!0};const i=["before-top","prepend-top","after-bottom","append-bottom"],n="mw-drop-indicator-position-",o=i.map(function(l){return n+l});let r=null;this.position=function(l,c){if(!(!l||!c)&&!(e.target===l&&e.position===c)){e.target=l,e.position=c,r!==c&&(this._indicator.removeClass(o),r=c,this._indicator.addClass(n+c));var m=_.offset(l);this._indicator.css({height:m.height,left:m.left,top:m.top,width:m.width}),this.show()}},this.make=function(){this._indicator=u(),this._indicator.html('<div class="mw-drop-indicator-block"><div class="mw-drop-indicator-pin"></div></div>'),this._indicator.addClass("mw-drop-indicator mw-drop-indicator-template-"+this.settings.template),this.hide(),this.settings.document.body.appendChild(this._indicator.get(0))},this.init=function(){this.make()},this.init()},At=(a,t,e)=>{!a||!t||(a=a.isMWElement?a.get(0):a,a.dataset.tooltip=t,a.title=t,a.dataset.tooltipposition=e||"top-center")},z=function(a){this.options=a||{};var t=this;this._visible=!0,this.isVisible=function(){return this._visible},this.show=function(){this._visible=!0,this.root.addClass("mw-le-handle-menu-visible")},this.hide=function(){this._visible=!1,this.root.removeClass("mw-le-handle-menu-visible")},this.create=function(){this.root=u({props:{className:"mw-le-handle-menu",id:t.options.id||"mw-le-handle-menu-"+new Date().getTime()}}),this.buttonsHolder=u({props:{className:"mw-le-handle-menu-buttons"}}),this.root.append(this.buttonsHolder)};var e,s,i,n=function(){e=u({props:{className:"mw-le-handle-menu-title"}}),s=u({props:{className:"mw-le-handle-menu-title-text"}}),i=u({props:{className:"mw-le-handle-menu-title-icon"}}),e.append(s),e.append(i),t.root.prepend(e),t.title=e},o=null;this.getTarget=function(){return o},this.setTarget=function(r){o=r;for(var l=0;l<this.buttons.length;l++)this.buttons[l].config.onTarget&&this.buttons[l].config.onTarget(r,this.buttons[l].button.get(0),t.options.rootScope)},this.setTitle=function(r,l){s.html(r||""),i.html(l||"")},this.buttons=[],this.buildButtons=function(r,l){l=l||this.buttonsHolder,r=r||this.options.buttons,r.forEach(function(c){l.append(t.button(c))})},this.button=function(r){var l=u({props:{className:"mw-le-handle-menu-button"+(r.className?" "+r.className:"")}}),c={props:{className:"mw-le-handle-menu-button-content"}},m=u(c);if(r.title&&At(m,r.title),r.icon){var g=u({props:{className:"mw-le-handle-menu-button-icon",innerHTML:r.icon}});m.append(g)}if(r.text){var d=u({props:{className:"mw-le-handle-menu-button-text",innerHTML:r.text}});m.append(d)}if(l.append(m),this.buttons.push({button:l,config:r}),r.menu){var p=u({props:{className:"mw-le-handle-menu-button-sub-menu"}});l.append(p),t.buildButtons(r.menu,p),l.on("click",function(){this.classList.toggle("sub-menu-active")})}else typeof r.action=="function"&&l.on("click",function(){r.action(t.getTarget(),l.get(0),{dialog:t.options.rootScope.dialog,tooltip:t.options.rootScope.tooltip})});return l},this.init=function(){this.create(),n(),this.setTitle(t.options.title,t.options.icon),this.buildButtons(),this.hide()},this.init()},Ot=function(a){this.root=u({props:{id:"mw-handle-item-element-root"}}),this.menu=new z({id:"mw-handle-item-element-menu",title:"Element",buttons:[{title:"Settings",text:"",icon:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z" /></svg>',className:"mw-handle-insert-button",onTarget:function(t,e){},action:function(t){a.dialog({})}},{title:a.lang("Delete"),text:"",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" /></svg>',className:"mw-handle-insert-button",action:function(t){}}]}),this.menu.show(),this.root.append(this.menu.root)},Bt=function(a){this.root=u({props:{id:"mw-handle-item-module-root",contentEditable:!1}}),this.menu=new z({id:"mw-handle-item-element-menu",title:"Module",rootScope:a,buttons:[]}),this.menu.show(),this.root.append(this.menu.root)},Dt=(a,t)=>{const e=u({props:{className:"le-dialog-footer"}}),s=u({props:{className:"le-btn le-btn-primary le-dialog-footer-ok",innerHTML:a||"OK"}}),i=u({props:{className:"le-btn le-dialog-footer-cancel"}});return e.append(i),e.append(s),{ok:s,cancel:i,footer:e}};var M,D,Z;class lt{constructor(t){v(this,D);v(this,M,{});t=t||{};const e={content:null,overlay:!0,closeOnEscape:!0,document,position:"centered",mode:"fixed"};this.settings=Object.assign({},e,t),this.build(),setTimeout(s=>this.open())}on(t,e){h(this,M)[t]?h(this,M)[t].push(e):h(this,M)[t]=[e]}dispatch(t,e){h(this,M)[t]&&h(this,M)[t].forEach(s=>{s.call(this,e)})}build(){this.root=u({props:{className:`le-dialog ${typeof this.settings.position=="string"?this.settings.position:""}`}});var t=u({props:{className:"le-dialog-close"}});t.on("click",()=>{this.remove()}),this.container=u({props:{className:"le-dialog-container"},content:this.settings.content}),this.root.append(t),this.root.append(this.container),this.settings.footer&&this.root.append(this.settings.footer.root||this.settings.footer),this.settings.document.body.appendChild(this.root.get(0)),this.settings.closeOnEscape&&this.settings.document.addEventListener("keydown",C(this,D,Z)),this.settings.overlay&&this.overlay()}open(){if(this.settings.position.nodeName&&this.settings.position.ownerDocument===this.settings.document){var t=this.settings.position;t.ownerDocument;var e=t.ownerDocument.defaultView,s=t.getBoundingClientRect(),i=s.top+e.scrollY,n=s.left+t.offsetWidth+e.scrollX,o=this.root.get(0);i+o.offsetHeight>e.innerHeight+e.scrollY&&(i-=i+o.offsetHeight-(e.innerHeight+e.scrollY)),n+o.offsetWidth>e.innerWidth&&(n-=n+o.offsetWidth-e.innerWidth),this.root.css({top:i,left:n,position:this.settings.mode})}this.root.addClass("le-dialog-opened")}remove(){this.root.on("transitionend",()=>{this.root.remove(),this.overlay&&this.overlay.remove()}),this.root.removeClass("le-dialog-opened"),this.settings.closeOnEscape&&this.settings.document.removeEventListener("keydown",C(this,D,Z)),this.dispatch("close")}overlay(){this.overlay=u({props:{className:"le-dialog-overlay"}}),this.settings.document.body.appendChild(this.overlay.get(0))}}M=new WeakMap,D=new WeakSet,Z=function(t){(t.key==="Escape"||t.keyCode===27)&&this.remove()};const It=function(a,t){const e=Dt(),s=new lt({content:a,footer:e,position:"centered"});return e.cancel.on("click",function(){s.remove()}),e.ok.on("click",function(){t&&t.call(),s.remove()}),s},G={},St=a=>new Promise(t=>{Array.isArray(a)?t(a):typeof a=="string"&&(G[a]?t(G[a]):fetch(a,{mode:"cors"}).then(e=>e.json()).then(e=>{G[a]=e,t(e)}))}),Pt=(a,t)=>{const e=u({props:{className:"le-selectable-items-list-item",moduleId:a.id},content:[{props:{className:"le-selectable-items-list-image",style:{backgroundImage:"url("+(a.icon||a.screenshot)+")"}}},{props:{className:"le-selectable-items-list-title",innerHTML:a.name}}]});return e.get(0).__data=a,e},Vt=(a,t)=>new Promise(e=>{if(!a||!a.id&&!a.layout_file){e(null);return}const s={ondrop:!0,id:a.id||"module-"+Date.now()};a.module?s["data-module-name"]=a.module:a.type==="layout"&&(s["data-module-name"]="layouts",s.template=a.layout_file);const i={method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}};fetch(t,i).then(n=>n.text()).then(n=>e(n))}),Rt=(a,t)=>{const e=u({props:{className:"le-selectable-items-list le-selectable-items-list-type-"+t}});return u({props:{className:"le-selectable-items-list le-selectable-items-list-type-"+t}}),a.forEach(function(s){e.append(Pt(s))}),e},Wt=function(a){var t=this;this.root=u({props:{id:"mw-handle-item-layout-root"}}),this.menu=new z({id:"mw-handle-item-layout-menu",title:a.lang("Layout"),rootScope:a,buttons:[{title:a.lang("Settings"),text:"",icon:'<svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 13.3 15.9" xml:space="preserve"><path d="M8.2,2.4L11,5.1l-8.2,8.2H0v-2.8L8.2,2.4z M11.8,4.3L9,1.6l1.4-1.4C10.5,0.1,10.7,0,10.9,0c0.2,0,0.4,0.1,0.5,0.2l1.7,1.7c0.1,0.1,0.2,0.3,0.2,0.5S13.3,2.8,13.1,3L11.8,4.3z"/><rect y="14.5" width="12" height="1.4"/></svg>',className:"mw-handle-insert-button",menu:[{title:a.lang("Add something"),text:a.lang("Add something"),icon:'<svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24" viewBox="0 0 24 24"><path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z" /></svg>',className:"mw-handle-insert-button"},{title:a.lang("Settings1212"),text:"Do alert",className:"mw-handle-insert-button"}]},{title:a.lang("Clone"),text:"",icon:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" /></svg>',className:"mw-handle-insert-button",action:function(e,s,i){var n=document.createElement("div");n.innerHTML=e.outerHTML,u("[id]",n).each(function(){this.id="le-id-"+new Date().getTime()}),u(e).after(n.innerHTML);var o=e.nextElementSibling;mw.reload_module(o,function(){i.statemanager.record({target:mw.tools.firstParentWithClass(e,"edit"),value:parent.innerHTML})})}},{title:a.lang("Move Down"),text:"",icon:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>',className:"mw-handle-insert-button",onTarget:function(e,s,i){e.nextElementSibling===null?s.style.display="none":s.style.display=""},action:function(e,s,i){i.handles.get("layout").hide();var n=e.nextElementSibling;if(n){var o=e.getBoundingClientRect(),r=n.getBoundingClientRect(),l=0;o.top<r.top&&(l=-(o.top-r.top)),e.classList.add("mw-le-target-to-animate"),n.classList.add("mw-le-target-to-animate"),e.style.transform="translateY("+l+"px)",n.style.transform="translateY("+-l+"px)",setTimeout(function(){n.parentNode.insertBefore(e,n.nextSibling),e.classList.remove("mw-le-target-to-animate"),n.classList.remove("mw-le-target-to-animate"),e.style.transform="",n.style.transform=""},300)}}},{title:a.lang("Move up"),text:"",icon:'<svg fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z" /></svg>',className:"mw-handle-insert-button",onTarget:function(e,s,i){e.previousElementSibling===null?s.style.display="none":s.style.display=""},action:function(e,s,i){i.handles.get("layout").hide();var n=e.previousElementSibling;if(n){var o=e.getBoundingClientRect(),r=n.getBoundingClientRect(),l=0;o.top>r.top&&(l=-(o.top-r.top)),e.classList.add("mw-le-target-to-animate"),n.classList.add("mw-le-target-to-animate"),e.style.transform="translateY("+l+"px)",n.style.transform="translateY("+-l+"px)",setTimeout(function(){n.parentNode.insertBefore(e,n),e.classList.remove("mw-le-target-to-animate"),n.classList.remove("mw-le-target-to-animate"),e.style.transform="",n.style.transform=""},300)}}},{title:a.lang("Delete"),text:"",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path  d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" /></svg>',className:"mw-handle-insert-button",action:function(e,s,i){It("Are you sure",function(){e.remove()})}}]}),this.addButtons=function(){if(a.settings.layouts){var e="Add Layout",s=function(i){St(a.settings.layouts).then(n=>{const o=Rt(n,"layouts");var r=a.dialog({content:o});u(".le-selectable-items-list-item",o).on("click",function(){Vt(this.__data,a.settings.loadModulesURL).then(function(l){var c;i==="top"?c="before":i==="bottom"&&(c="after"),u(t.handle.getTarget())[c](l)}),r.remove()})})};this.plusTop=u({props:{className:"mw-handle-item-layout-plus mw-handle-item-layout-plus-top",innerHTML:a.lang(e)}}),this.plusBottom=u({props:{className:"mw-handle-item-layout-plus mw-handle-item-layout-plus-bottom",innerHTML:a.lang(e)}}),this.plusTop.on("click",function(){s("top")}),this.plusBottom.on("click",function(){s("bottom")}),this.root.append(this.plusTop),this.root.append(this.plusBottom)}},this.menu.show(),this.addButtons(),this.root.append(this.menu.root)},nt={en:{Layout:"Layout","Add layout":"Add layout",Title:"Title",Settings:"Settings",Paragraph:"Paragraph",Text:"Text"},bg:{}},Yt=(a,t)=>((!t||!nt[t])&&(t="en"),nt[t][a]||a);class ht{constructor(t){const e=this,s={};this.on=(d,p)=>{s[d]?s[d].push(p):s[d]=[p]},this.dispatch=(d,p)=>{s[d]&&s[d].forEach(E=>{E.call(this,p)})},this.paused=!1;var i={elementClass:"element",backgroundImageHolder:"background-image-holder",cloneableClass:"cloneable",editClass:"edit",stateManager:null,moduleClass:"module",nodrop:"nodrop",allowDrop:"allow-drop",unEditableModules:['[type="template_settings"]'],frameworksClasses:{col:["col","mw-col"]},document,mode:"manual",lang:"en",strict:!0,strictLayouts:!1,viewWindow:window,modules:[{type:"layout",directory:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/",template_dir:"casamia",name:"CLEAN CONTAINER",position:0,layout_file:"skin-1.php",filename:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/skin-1.php",screenshot_file:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/skin-1.jpg",screenshot:"https://unit.microweber.com/userfiles/templates/casamia/modules/layouts/templates/skin-1.jpg",data:"http://asas.com"},{type:"layout",directory:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/",template_dir:"casamia",name:"lang Key",position:0,layout_file:"skin-lang-key.php",filename:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/skin-lang-key.php"}],xlayouts:"https://unit.microweber.com/api/get_layouts_list_json",layouts:[{type:"layout",directory:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/",template_dir:"casamia",name:"CLEAN CONTAINER",position:0,layout_file:"skin-1.php",filename:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/skin-1.php",screenshot_file:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/skin-1.jpg",screenshot:"https://unit.microweber.com/userfiles/templates/casamia/modules/layouts/templates/skin-1.jpg"},{type:"layout",directory:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/",template_dir:"casamia",name:"lang Key",position:0,layout_file:"skin-lang-key.php",filename:"/home/unitmicroweber/public_html/userfiles/templates/casamia/modules/layouts/templates/skin-lang-key.php"}],loadModulesURL:"http://localhost/mw2/module"};this.settings=L.extend({},i,t),this.document=this.settings.document,this.stateManager=this.settings.stateManager,this.lang=function(d){return Yt(d,this.settings.lang)},this.settings.root||(this.settings.root=this.settings.document.body),this.root=this.settings.root,this.elementAnalyzer=new rt(this.settings),this.dropIndicator=new Tt(this.settings);const n=new Ot(this),o=new Bt(this),r=new Wt(this);this.elementHandleContent=n,this.moduleHandleContent=o,this.layoutHandleContent=r,this.dialog=function(d){d||(d={});var p={document:window.top.document,position:o.menu.getTarget(),mode:"absolute"};e.pause();const E=new lt(L.extend({},p,d));return E.on("close",function(){e.play()}),E};var l=this.elementHandle=new j({...this.settings,dropIndicator:this.dropIndicator,content:n.root,handle:n.menu.title,document:this.settings.document,stateManager:this.settings.stateManager});l.on("targetChange",function(d){n.menu.setTarget(d);var p="";d.nodeName==="P"?p=e.lang("Paragraph"):/(H[1-6])/.test(d.nodeName)?p=e.lang("Title")+" "+d.nodeName.replace(/^\D+/g,""):d.nodeName==="IMG"||d.nodeName==="IMAGE"?p=e.lang("Image"):p=e.lang("Text"),n.menu.setTitle(p)}),this.moduleHandle=new j({...this.settings,dropIndicator:this.dropIndicator,content:o.root,handle:o.menu.title,document:this.settings.document,stateManager:this.settings.stateManager});var c=this.moduleHandle;this.getModuleQuickSettings=d=>new Promise(p=>{p(mw.quickSettings[d]),this.dispatch("moduleQuickSettings",{module:d})}),c.on("targetChange",function(d){e.getModuleQuickSettings(d.dataset.type).then(function(p){o.menu.root.remove(),o.menu=new z({id:"mw-handle-item-element-menu",title:d.dataset.type,rootScope:e,buttons:p?p.mainMenu||[]:[],data:{target:d}}),o.menu.setTarget(d),o.menu.show(),o.root.append(o.menu.root)})}),this.layoutHandle=new j({...this.settings,dropIndicator:this.dropIndicator,content:r.root,handle:r.menu.title,document:this.settings.document,stateManager:this.settings.stateManager,type:"layout"});var m=this.layoutHandle,g=e.lang("Layout");r.menu.setTitle(g),m.on("targetChange",function(d){r.menu.setTarget(d),r.menu.setTitle(g),e.elementAnalyzer.isEditOrInEdit(d)?(r.plusTop.show(),r.plusBottom.show()):(r.plusTop.hide(),r.plusBottom.hide())}),r.handle=m,o.handle=c,n.handle=l,this.handles=new xt({element:l,module:c,layout:m}),this.observe=new Et(this.settings),this.init()}play(){this.paused=!1}pause(){this.handles.hide(),this.paused=!0}init(){this.settings.mode==="auto"&&Ht(this),u(this.root).on("mousemove touchmove",t=>{if(!this.paused&&t.pageX%2===0){const e=this.observe.fromEvent(t),s=e[0];if(s){const i=this.elementAnalyzer.getType(s);i&&i!=="edit"&&(this.handles.set(i,e[0]),i==="element"?this.handles.hide("module"):i==="module"&&this.handles.hide("element"))}}})}}globalThis.LiveEdit=ht;const Ft=()=>{mw.app.get("canvas").getFrame().parentElement;const t=mw.app.get("canvas").getDocument(),e=t.createElement("link");e.rel="stylesheet",e.href=`${mw.settings.site_url}userfiles/modules/microweber/api/liveedit2/css/dist.css`,t.head.prepend(e);const s=new ht({root:t.body,strict:!1,mode:"auto",document:t});mw.app.call("onLiveEditReady"),mw.app.register("liveEdit",s),mw.app.register("state",mw.liveEditState)};var b,k,x,I,Q,S,K,F,dt;class ct{constructor(t={}){v(this,I);v(this,S);v(this,F);v(this,b,null);v(this,k,{});O(this,"selectedCategory","");v(this,x,[]);O(this,"root",null);const e={mode:"local",document,encapsulate:!1,css:!1,searchMode:"local",data:[],skin:"defaultModules"};this.settings=Object.assign({},e,t),this.document=this.settings.document}on(t,e){h(this,k)[t]?h(this,k)[t].push(e):h(this,k)[t]=[e]}dispatch(t,e){h(this,k)[t]&&h(this,k)[t].forEach(s=>{s.call(this,e)})}getData(){return h(this,b)}setData(t,e=!0){X(this,b,t);let s=0,i=h(this,b).length;for(;s<i;s++)typeof h(this,b)[s].categories=="string"&&(h(this,b)[s].categories=h(this,b)[s].categories.split(",").map(n=>n.trim()));e&&this.dispatch("dataChanged",h(this,b))}prepareCategories(){const t=[],e=this.getData();let s=0,i=e.length;for(;s<i;s++){let o=e[s].categories||"",r=0,l=o.length;for(;r<l;r++){const c=o[r].trim();t.indexOf(c)===-1&&t.push(c)}}t.sort(),this.categories=t}createCategoriesMenu(){const t=this.document.createElement("ul");this.prepareCategories(),t.className="modules-list-categories",t.innerHTML=this.categories.map(e=>`<li data-category="${e}">${e}</li>`).join(""),t.innerHTML=`<li data-category="">All categories</li> ${t.innerHTML}`,t.addEventListener("click",e=>{e.target.nodeName==="LI"&&this.selectCategory(e.target.dataset.category)}),this.categoriesNavigation=t,this.rootShadow.appendChild(t),this.on("categorySelect",e=>{const s=t.querySelectorAll("[data-category]");for(const i of s)i.classList[i.dataset.category===e?"add":"remove"]("active")})}selectCategory(t=""){this.selectedCategory=t,this.search(t),this.dispatch("categorySelect",t)}createRoot(){if(this.root=this.document.createElement("div"),this.root.className="modules-list modules-list-"+this.settings.skin,this.rootShadow=this.settings.encapsulate?this.root.attachShadow({mode:"open"}):this.root,this.settings.css){let t=document.createElement("style");t.textContent=this.settings.css,this.rootShadow.appendChild(t)}}renderModulesCategorized(){this.modulesList=this.document.createElement("div"),this.modulesList.className="modules-list-block",this.modulesListNoResultsNode=this.document.createElement("div"),this.modulesListNoResultsNode.className="modules-list-block-no-results",this.modulesListNoResultsNode.innerHTML="Nothing found...",this.modulesListNoResultsNode.style.display="none";const t=this.getData();let e=0,s=t.length;const i={miscellaneous:C(this,S,K).call(this,"miscellaneous")};for(;e<s;e++)(t[e].categories||["miscellaneous"]).forEach(o=>{i[o]||(i[o]=C(this,S,K).call(this,o));const r=C(this,I,Q).call(this,t[e]);h(this,x).push(r),i[o].appendChild(r),i[o].__$hasNodes=!0});for(const n in i)i[n].__$hasNodes&&this.modulesList.appendChild(i[n]);this.rootShadow.appendChild(this.modulesList),this.modulesList.appendChild(this.modulesListNoResultsNode)}renderModules(){this.modulesList=this.document.createElement("div"),this.modulesList.className="modules-list-block",this.modulesListNoResultsNode=this.document.createElement("div"),this.modulesListNoResultsNode.className="modules-list-block-no-results",this.modulesListNoResultsNode.innerHTML="Nothing found...",this.modulesListNoResultsNode.style.display="none";const t=this.getData();let e=0,s=t.length;for(;e<s;e++){const i=C(this,I,Q).call(this,t[e]);h(this,x).push(i),this.modulesList.appendChild(i)}this.rootShadow.appendChild(this.modulesList),this.modulesList.appendChild(this.modulesListNoResultsNode)}hideItem(t){t.nodeName&&(t.style.display="none")}showItem(t){t.nodeName&&(t.style.display="")}createSearchGUI(){this.searchBlock=this.document.createElement("div"),this.searchField=this.document.createElement("input"),this.searchField.type="text",this.searchField.placeholder="Type to Search...",this.searchBlock.className="modules-list-search-block",this.searchField.className="modules-list-search-field",this.searchBlock.appendChild(this.searchField),this.rootShadow.appendChild(this.searchBlock),this.searchField.addEventListener("input",t=>this.search(void 0,this.searchField.value)),this.on("categorySelect",t=>{this.searchField.value=""})}async search(t="",e=""){if(this.settings.searchMode==="local")return C(this,F,dt).call(this,t,e)}async createCategorized(){return this.setData(this.settings.data),this.createRoot(),this.createSearchGUI(),this.renderModulesCategorized(),new Promise(t=>{t(this)})}async create(){return this.setData(this.settings.data),this.createRoot(),this.createCategoriesMenu(),this.renderModules(),this.createSearchGUI(),new Promise(t=>{t(this)})}}b=new WeakMap,k=new WeakMap,x=new WeakMap,I=new WeakSet,Q=function(t){t.locked=t.description.includes("a");const e=this.document.createElement("div");return e.className="modules-list-block-item modules-list-block-item-is-locked-"+t.locked,e.__$data=t,e.innerHTML=`
            <div class="modules-list-block-item-picture" style="background-image: url(${t.icon||t.screenshot||t.image})"></div>
            <div class="modules-list-block-item-title">${t.name||t.title}</div>
            <div class="modules-list-block-item-description">${t.description}</div>
            ${t.locked?'<span class="modules-list-block-item-locked-badge">PRO</span>':""}
        `,e.addEventListener("click",s=>{s.stopPropagation(),e.__$data.locked?this.dispatch("lockedModuleSelected",{data:t,element:e}):this.dispatch("moduleSelected",{data:t,element:e})}),e.$data=t,e},S=new WeakSet,K=function(t){const e=this.document.createElement("div");return e.className="modules-list-block-category-section",e.innerHTML='<div class="modules-list-block-category-section-title"><h5>'+t+"</h5></div>",e.__$hasNodes=!1,e},F=new WeakSet,dt=async function(t,e){return t&&(t=t.trim().toLowerCase()),e&&(e=e.trim().toLowerCase()),new Promise(s=>{let i=0,n=h(this,x).length,o=0;for(;i<n;i++){const r=h(this,x)[i],l=r.$data;if(t&&l.categories.indexOf(t)===-1){this.hideItem(r);continue}if(e&&(l.name||l.title).toLowerCase().indexOf(e)===-1){this.hideItem(r);continue}this.showItem(r),o++}console.log(e,t),this.modulesListNoResultsNode.style.display=o===0?"":"none",s()})};const W=[],ut=function(a){W.push(this),this.dialog=mw.element({props:{className:"mw-le-dialog-block "+a}}),this.overlay=mw.element({props:{className:"mw-le-overlay"}}),this.open=function(){this.dialog.addClass("active"),this.overlay.addClass("active"),this.closeButton.addClass("active")},this.close=function(){this.dialog.removeClass("active"),this.overlay.removeClass("active"),this.closeButton.removeClass("active")},this.remove=function(){this.close(),setTimeout(()=>{this.dialog.remove(),this.overlay.remove(),this.closeButton.remove()},400)},this.closeButton=mw.element({props:{className:"mw-le-dialog-close"}}),this.closeButton.on("click",t=>{this.remove()}),mw.element(document.body).append(this.overlay),mw.element(document.body).append(this.dialog),mw.element(document.body).append(this.closeButton),setTimeout(()=>{this.open()},100)};document.addEventListener("keydown",function(a){(a.key==="Escape"||a.keyCode===27)&&W.length>0&&(W[0].remove(),W.splice(0,1))});var J,ot=function(a){var t=new ct({data:J});t.create().then(function(){var e=mw.element({props:{className:"mw-le-layouts-dialog-row"}}),s=mw.element({props:{className:"mw-le-layouts-dialog-col"}}),i=mw.element({props:{className:"mw-le-layouts-dialog-col"}});e.append(s),e.append(i),mw.element(t.root).append(e),s.append(t.searchBlock);var n=mw.element({props:{innerHTML:"Categories",className:"mw-le-layouts-dialog-categories-title"}});s.append(n),s.append(t.categoriesNavigation),i.append(t.modulesList),a.append(t.root)})};const zt=()=>{var a=new ut("mw-le-layouts-dialog"),t=a.dialog;if(J){ot(t);return}mw.spinner({element:t.get(0),decorate:!0}),fetch(`${mw.settings.site_url}api/module/list?layout_type=layout&elements_mode=true&group_layouts_by_category=true`).then(function(e){return e.json()}).then(function(e){J=e,ot(t),mw.spinner({element:t.get(0),decorate:!0}).remove()})};var tt,at=function(a){var t=new ct({data:tt});t.createCategorized().then(function(){a.append(t.root)})};const $t=()=>{var a=new ut("mw-le-modules-dialog"),t=a.dialog;mw.$("#mw-plus-tooltip-selector li").each(function(){this.onclick=function(){var e=mw.$(this).attr("data-module-name"),s={class:this.className};e==="layout"&&(s.template=mw.$(this).attr("template")),mw.module.insert(mw._activeElementOver,e,s,mw.handleElement.positionedAt,mw.liveEditState),mw.wysiwyg.change(mw._activeElementOver),tooltip.remove()}}),tt?at(t):(mw.spinner({element:t.get(0),decorate:!0}),fetch(`${mw.settings.site_url}api/module/list?layout_type=module`).then(function(e){return e.json()}).then(function(e){tt=e,at(t),mw.spinner({element:t.get(0),decorate:!0}).remove()}))},qt={cssEditor:function(){document.getElementById("css-editor-template").classList.toggle("active")},themeEditor:function(){document.getElementById("general-theme-settings").classList.toggle("active")},insertModule:function(){return $t()},insertLayout:function(){return zt()}};mw.app=new gt;const mt=new wt,Xt=document.getElementById("live-edit-frame-holder");mt.mount(Xt);mw.app.register("canvas",mt);mw.app.register("commands",qt);mw.app.canvas.on("liveEditCanvasLoaded",()=>{new vt,Ft();class a extends Y{constructor(){super(),mw.app.get("liveEdit").moduleHandle.on("targetChange",n=>{this.dispatch("targetChange",n)})}}class t extends Y{constructor(){super(),mw.app.get("liveEdit").elementHandle.on("targetChange",n=>{this.dispatch("targetChange",n)})}}const e={handle:{module:new a,element:new t}};mw.app.register("editor",e)});
